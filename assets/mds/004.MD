## Eureka

### 1. 基础知识
看视频了解一些概念。
[![Watch the video]](https://rr3---sn-npoeenez.googlevideo.com/videoplayback?expire=1664805564&ei=XJY6Y8eUEIbp4QT1zoCQBA&ip=209.107.196.106&id=o-AD_o7aDBftyEA-Axsr4Doe7GUtQ_3ycOv3iZxu7gPEnZ&itag=22&source=youtube&requiressl=yes&spc=yR2vp4gFKlBKY3nPkljwwbrTy98v4Ss&vprv=1&mime=video%2Fmp4&ns=L1Qsgnl3Li3lP61Rp9KrPgkI&cnr=14&ratebypass=yes&dur=685.778&lmt=1583583766676577&fexp=24001373,24007246&c=WEB&txp=2211222&n=kLfhy7-E66Uu8g&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Cmime%2Cns%2Ccnr%2Cratebypass%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAP8eF0qW5fyPhObH4PWEoKJ5Zh5Iy7ZsOOfhPsr7Biv7AiBhnBiLVP5tdFxt4mdyFHXNUczsd7ylMIfMgu8misu7QA%3D%3D&title=%E5%B0%9A%E7%A1%85%E8%B0%B7SpringCloud%E7%AC%AC%E4%BA%8C%E5%AD%A3%2015%20Eureka%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86&rm=sn-5uae777s&req_id=73f67ab8ff2ba3ee&ipbypass=yes&redirect_counter=2&cm2rm=sn-i3b6k76&cms_redirect=yes&cmsv=e&mh=hJ&mip=165.154.225.62&mm=34&mn=sn-npoeenez&ms=ltu&mt=1664783810&mv=m&mvi=3&pl=25&lsparams=ipbypass,mh,mip,mm,mn,ms,mv,mvi,pl&lsig=AG3C_xAwRAIgFGGGOhzkJN5HWWLDzNMHo9tzPdhXOrH9-yRD0Hc9IVICIDnrQz5gROX9Y9IEUK4CsOdt6JXzTMYz2f8JX5OF6qz4)
Q&A

Q:为什么80不能直接访问8001？

    A:因为......
   
Q:什么是服务治理？

    A:(google)服务治理是一个非常宽泛的概念，一般指独立于业务逻辑之外，给系统提供一些可靠运行的系统保障措施。
    针对微服务场景下的常用故障模式，提供的保障措施包括： 负载均衡管理：提供多实例情况下的负载均衡策略管理，
    比如采用轮询的方式保障流量在不同实例均衡。
   
    A:(作者)Spring Cloud封装了Netflix公司开发的Eureka模块来实现服务治理。在传统的rpc远程调用框架中，
    管理每个服务与服务之间依赖关系比较复杂，管理比较复杂，所以需要使用服务治理，管理服务与服务之间的依赖关系，
    可以实现服务调用、负载均衡、容错等，实现服务发现与注册。
   
Q: 什么是服务注册与发现？

    A:看图

   ![](https://github.com/YuxingXie/springcloud/raw/master/assets/images/002.jpg)   
   ![](https://github.com/YuxingXie/springcloud/raw/master/assets/images/003.jpg)    
Q: Eureka有哪两个组件？

    A:看图

   ![](https://github.com/YuxingXie/springcloud/raw/master/assets/images/004.jpg)   

### 2. 单机Eureka的构建

#### 2.1. 创建cloud-eureka-server7001子模块

不多说，用gradle创建。

##### 2.1.1. build.gradle

添加如下依赖：

```groovy

dependencies {
    implementation project(':cloud-project-commons')
//    compile('org.springframework.cloud:spring-cloud-starter-netflix-eureka-server')
    compile('org.springframework.cloud:spring-cloud-starter-netflix-eureka-server:2.2.10.RELEASE')
    compile('org.springframework.cloud:spring-cloud-dependencies:Hoxton.SR1')
    compile('org.springframework.boot:spring-boot-starter-web:2.2.2')
    compile("org.springframework.boot:spring-boot-starter-actuator:2.2.2.RELEASE")
    compile("com.google.code.gson:gson:2.8.2")

    runtime('org.springframework.boot:spring-boot-devtools:2.2.2.RELEASE')
    testCompile("org.springframework.boot:spring-boot-starter-test:2.2.2.RELEASE")
}

```

这里spring-boot和springCloud版本把我整得有点惨，需要匹配。另外com.google.code.gson:gson:2.8.2也必须引入。

网上找到一个对应关系表：
![](https://github.com/YuxingXie/springcloud/raw/master/assets/images/005.jpg)  
![](https://github.com/YuxingXie/springcloud/raw/master/assets/images/006.jpg)  

##### 2.1.2. application.properties

```properties
server.port=7001

#eureka服务端的实例名称
eureka.instance.hostname=localhost
#false表示不向注册中心注册自己
eureka.client.register-with-eureka=false

#false表示自己端就是注册中心，职责就是维护服务实例，并不需要去检索服务
eureka.client.fetch-registry=false

#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址
eureka.client.server-url.defaultZone=http://${eureka.instance.hostname}:${server.port}/eureka/
```

##### 2.1.3. 主启动类

EurekaMain7001.java:
```java
package com.lingyun.study.springcloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;
import org.springframework.context.ApplicationListener;
import org.springframework.context.event.ContextRefreshedEvent;

@SpringBootApplication
@EnableEurekaServer
public class EurekaMain7001 implements ApplicationListener<ContextRefreshedEvent> {
        public static void main(String[] args){

                SpringApplication.run(EurekaMain7001.class, args);
        }

        @Override
        public void onApplicationEvent(ContextRefreshedEvent event) {

        }
}

```
访问 http://localhost:7001 ，启动成功！

#### 2.2. payment8001入驻进eureka server